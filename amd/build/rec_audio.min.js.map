{"version":3,"file":"rec_audio.min.js","sources":["../src/rec_audio.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Poodll - audio recorder configuration.\n *\n * @module      tiny_poodll/audio_recorder\n * @copyright   2023 Justin Hunt <justin@poodll.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString, get_strings as getStrings} from 'core/str';\nimport Pending from 'core/pending';\nimport {getCloudpoodll} from './options';\nimport uploadFile from 'editor_tiny/uploader';\nimport {add as addToast} from 'core/toast';\nimport * as ModalEvents from 'core/modal_events';\nimport * as ModalFactory from 'core/modal_factory';\nimport * as Templates from 'core/templates';\nimport {saveCancelPromise} from 'core/notification';\nimport {prefetchStrings, prefetchTemplates} from 'core/prefetch';\nimport Modal from \"./modal\";\nimport ModalRegistry from 'core/modal_registry';\n\nimport {\n    component,\n    INSERTMETHOD,\n    LANGUAGE,\n    CSS,\n    SKIN\n} from './common';\n\n/**\n * The Poodll base class for audio, video, and any other future types\n */\nexport default class {\n\n    /**\n     * Constructor for the Tiny Poodll Recorder\n     *\n     * @param {TinyMCE} editor The Editor to which the content will be inserted\n     * @param {Modal} modal The Moodle Modal that contains the interface used for recording\n     * @param {config} config The data passed to template and used internally for managing plugin state\n     */\n    constructor(editor, modal, config) {\n        this.ready = false;\n/*\n        if (!this.checkAndWarnAboutBrowserCompatibility()) {\n            return;\n        }\n*/\n        this.editor = editor;\n        this.config = config;//getData(editor).params;\n        this.modal = modal;\n        this.modalRoot = modal.getRoot()[0];\n   //     this.startStopButton = this.modalRoot.querySelector('button[data-action=\"startstop\"]');\n   //     this.uploadButton = this.modalRoot.querySelector('button[data-action=\"upload\"]');\n\n        // Disable the record button untilt he stream is acquired.\n    //    this.setRecordButtonState(false);\n\n    //    this.player = this.configurePlayer();\n        this.registerEventListeners();\n        this.ready = true;\n\n      //  this.captureUserMedia();\n      //  this.prefetchContent();\n    }\n\n    /**\n     * Close the modal and stop recording.\n     */\n    close() {\n        // Closing the modal will destroy it and remove it from the DOM.\n        // It will also stop the recording via the hidden Modal Event.\n        this.modal.hide();\n    }\n\n    /**\n     * Register event listeners for the modal.\n     */\n    registerEventListeners() {\n        /*\n        this.modalRoot.addEventListener('click', this.handleModalClick.bind(this));\n        this.modal.getRoot().on(ModalEvents.outsideClick, this.outsideClickHandler.bind(this));\n        this.modal.getRoot().on(ModalEvents.hidden, () => {\n            this.cleanupStream();\n            this.requestRecordingStop();\n        });\n\n         */\n    }\n\n\n    /**\n     * Display the widgets dialog\n     *\n     * @method _displayDialogue\n     * @private\n     */\n    displayWidgetsDialogue(e, clickedicon) {\n        e.preventDefault();\n        var width = 800;\n\n        var dialogue = this.getDialogue({\n            headerContent: M.util.get_string('dialogtitle', COMPONENTNAME),\n            width: width + 'px',\n            focusAfterHide: clickedicon\n        });\n        //dialog doesn't detect changes in width without this\n        //if you reuse the dialog, this seems necessary\n        if (dialogue.width !== width + 'px') {\n            dialogue.set('width', width + 'px');\n        }\n\n\n        //create content container\n        var bodycontent = Y.Node.create('<div></div>');\n\n        //create and append header\n        var template = Y.Handlebars.compile(BUTTONSHEADERTEMPLATE),\n            content = Y.Node.create(template({\n                headertext: M.util.get_string('chooseinsert', COMPONENTNAME)\n            }));\n        bodycontent.append(content);\n\n        //get button nodes\n        var buttons = this._getButtonsForNames(clickedicon);\n\n        Y.Array.each(buttons, function (button) {\n            bodycontent.append(button);\n        }, bodycontent);\n\n        //set to bodycontent\n        dialogue.set('bodyContent', bodycontent);\n        dialogue.show();\n\n        this.markUpdated();\n    }\n\n    getButtonsForNames(clickedicon) {\n        var allcontent = [];\n        Y.Array.each(CLOUDPOODLL.names, function (thename, currentindex) {\n            //loop start\n            var template = Y.Handlebars.compile(BUTTONTEMPLATE),\n                content = Y.Node.create(template({\n                    elementid: this.get('host').get('elementid'),\n                    name: thename,\n                    templateindex: currentindex\n                }));\n            this._form = content;\n            content.one('.' + CSS.NAMEBUTTON + '_' + currentindex).on('click', this._showTemplateForm, this, currentindex);\n            allcontent.push(content);\n            //loop end\n        }, this);\n\n        return allcontent;\n    }\n\n    /**\n     * Return the widget dialogue content for the tool, attaching any required\n     * events.\n     *\n     * @method _getSubmitButtons\n     * @return {Node} The content to place in the dialogue.\n     * @private\n     */\n    getSubmitButtons(templateindex) {\n\n        var template = Y.Handlebars.compile(SUBMITTEMPLATE),\n\n            content = Y.Node.create(template({\n                elementid: this.get('host').get('elementid'),\n                inserttext: M.util.get_string('insert', COMPONENTNAME)\n            }));\n\n        content.one('.' + CSS.INPUTSUBMIT).on('click', this._doWidgetsInsert, this, templateindex);\n        return content;\n    }\n\n    /**\n     * Display the cloud poodll tool.\n     *\n     * @method _displayDialogue\n     * @private\n     */\n    displayDialogue(e, recorder) {\n        e.preventDefault();\n        this._currentrecorder = recorder;\n\n        if (recorder == RECORDERS.WIDGETS) {\n            this._displayWidgetsDialogue(e, recorder);\n            return;\n        }\n\n        STATE.currentrecorder = recorder;\n\n        //get title and sizes\n        switch (recorder) {\n            case RECORDERS.SCREEN:\n                var title = M.util.get_string('createscreen', COMPONENTNAME);\n                var width = '502';\n                var height = \"660\";\n                break;\n\n            case RECORDERS.VIDEO:\n                var title = M.util.get_string('createvideo', COMPONENTNAME);\n                switch (CLOUDPOODLL.videoskin) {\n                    case SKIN.ONETWOTHREE:\n                        var width = '500';\n                        var height = \"660\";\n                        break;\n                    case SKIN.PLAIN:\n                        var width = '500';\n                        var height = \"580\";\n                        break;\n                    case SKIN.BMR:\n                        var width = '500';\n                        var height = \"620\";\n                        break;\n                    default:\n                        var width = '500';\n                        var height = false;\n\n                }\n                break;\n            case RECORDERS.AUDIO:\n            default:\n                var title = M.util.get_string('createaudio', COMPONENTNAME);\n                var width = '501';\n                var height = false;\n                break;\n        }\n\n        //set default subtitling flag\n        if (CLOUDPOODLL.cansubtitle) {\n            if (STATE.currentrecorder == RECORDERS.VIDEO ||\n                STATE.currentrecorder == RECORDERS.SCREEN) {\n                STATE.subtitling = STATE.subtitlevideobydefault;\n            } else {\n                STATE.subtitling = STATE.subtitleaudiobydefault;\n            }\n        }else{\n            STATE.subtitling = 0;\n        }\n\n        var d_conf = {};\n        d_conf.center = true;\n        d_conf.headerContent = title;\n        d_conf.focusAfterHide = recorder;\n        d_conf.width = width + 'px';\n        if (height) {\n            d_conf.height = height + 'px';\n        }\n\n        var dialogue = this.getDialogue(d_conf);\n\n        //if this dialog had a different size and title (it was popped up before as diff media recorder type)\n        if (dialogue.get('width') != width + 'px') {\n            dialogue.set('headerContent', title);\n            //sadly the width and height won't change .. whatever\n            dialogue.set('width', width + 'px');\n            dialogue.set('height', height + 'px');\n        }\n\n        var output = '';\n        if (CLOUDPOODLL.token == '') {\n            output = M.util.get_string('notoken', COMPONENTNAME);\n        } else {\n            //this block should be portioned into an async/await and function, but shifter wont allow it.\n            var context = this._getContext();\n            var that = this;\n            require(['core/templates','core/ajax', 'core/notification'], function (templates,ajax, notification) {\n\n                templates.render('atto_cloudpoodll/root', context).then(function (html, js) {\n                    output = html;\n                    var content = Y.Node.create(output);\n\n                    // Set the dialogue content, and then show the dialogue.\n                    dialogue.set('bodyContent', content).show();\n\n\n                    //store some common elements we will refer to later\n                    STATE.elementid = that.get('host').get('elementid');\n                    STATE.subtitlecheckbox = Y.one('#' + STATE.elementid + '_' + CSS.SUBTITLE_CHECKBOX);\n                    STATE.mediainsertcheckbox = Y.one('#' + STATE.elementid + '_' + CSS.MEDIAINSERT_CHECKBOX);\n                    STATE.languageselect = Y.one('#' + STATE.elementid + '_' + CSS.LANG_SELECT);\n                    STATE.expiredays = Y.one('#' + STATE.elementid + '_' + CSS.EXPIREDAYS_SELECT);\n                    var topnode = Y.one('#' + STATE.elementid + '_' + CSS.ATTO_CLOUDPOODLL_FORM);\n\n\n                    //this is important?\n                    poodllRecorder = that;\n\n                    //subtitle checkbox click event.. reload recorders\n                    if (STATE.subtitlecheckbox != null) {\n                        //if we can subtitle, handle events, otherwise disable it\n                        if (CLOUDPOODLL.cansubtitle) {\n                            STATE.subtitlecheckbox.on('click', function (e) {\n                                var element = e.currentTarget;\n                                //update recorder subtitle setting\n                                if (element.get('checked')) {\n                                    topnode.all('.' + CSS.CP_SWAP).setAttribute('data-transcribe', '1');\n                                    topnode.all('.' + CSS.CP_SWAP).setAttribute('data-subtitle', '1');\n                                    topnode.all('.' + CSS.CP_SWAP).setAttribute('data-alreadyparsed', 'false');\n                                    STATE.subtitling = true;\n                                } else {\n                                    topnode.all('.' + CSS.CP_SWAP).setAttribute('data-transcribe', '0');\n                                    topnode.all('.' + CSS.CP_SWAP).setAttribute('data-subtitle', '0');\n                                    topnode.all('.' + CSS.CP_SWAP).setAttribute('data-alreadyparsed', 'false');\n                                    STATE.subtitling = false;\n                                }\n                                //reload the recorders\n                                topnode.all('.' + CSS.CP_SWAP).empty();\n                                that._loadRecorders();\n                            });\n                        } else {\n                            this._disableSubtitleCheckbox();\n                        }\n                    }\n\n                    //insert method checkbox;\n                    if (STATE.mediainsertcheckbox != null) {\n                        STATE.mediainsertcheckbox.on('click', function (e) {\n                            var element = e.currentTarget;\n                            //update recorder subtitle setting\n                            if (element.get('checked')) {\n                                STATE.insertmethod = INSERTMETHOD.TAGS;\n                            } else {\n                                STATE.insertmethod = INSERTMETHOD.LINK;\n                            }\n                        });\n                    }\n\n                    //language selector\n                    if (STATE.languageselect != null) {\n                        STATE.languageselect.on('change', function (e) {\n                            var element = e.currentTarget;\n                            if (element) {\n                                CLOUDPOODLL.language =element.get('value');\n                                topnode.all('.' + CSS.CP_SWAP).setAttribute('data-language', CLOUDPOODLL.language);\n                                topnode.all('.' + CSS.CP_SWAP).setAttribute('data-alreadyparsed', 'false');\n                                //reload the recorders\n                                topnode.all('.' + CSS.CP_SWAP).empty();\n                                that._loadRecorders();\n                            }\n                        });\n                    }\n\n                    //expire days selector\n                    if (STATE.expiredays != null) {\n                        STATE.expiredays.on('change', function (e) {\n                            var element = e.currentTarget;\n                            if (element) {\n                                CLOUDPOODLL.expiredays = element.get('value');\n                                topnode.all('.' + CSS.CP_SWAP).setAttribute('data-expiredays', CLOUDPOODLL.expiredays);\n                                topnode.all('.' + CSS.CP_SWAP).setAttribute('data-alreadyparsed', 'false');\n                                //reload the recorders\n                                topnode.all('.' + CSS.CP_SWAP).empty();\n                                that._loadRecorders();\n                            }\n                        });\n                    }\n\n                    //so finally load those recorders\n                    that._loadRecorders();\n\n\n                }).fail(function (ex) {\n                    notification.exception(ex);\n\n                });\n            });\n\n        }//end of if cloudpoodll token\n    }\n\n    disableSubtitleCheckbox() {\n        //this function is never called, because if not transcribable, not shown\n        STATE.subtitlecheckbox.setAttribute('disabled', true);\n        var topnode = Y.one('#' + STATE.elementid + '_' + CSS.ATTO_CLOUDPOODLL_FORM);\n        topnode.all('.' + CSS.CP_SWAP).setAttribute('data-transcribe', '0');\n        topnode.all('.' + CSS.CP_SWAP).setAttribute('data-subtitle', '0');\n    }\n\n    /**\n     * Loads the history tab html.\n     *\n     * @method loadHistory\n     */\n    loadHistory() {\n        require(['core/templates','core/ajax', 'core/notification'], function (templates,ajax, notification) {\n            ajax.call([{\n                methodname: 'atto_cloudpoodll_history_get_items',\n                args: {'recordertype' : STATE.currentrecorder},\n                done: function (historyitems) {\n                    /**\n                     * Takes a mysql unix timestamp (in seconds) and converts to a display date.\n                     *\n                     * @method _formatUnixDate\n                     * @param dateToFormat Date to format\n                     */\n                    function _formatUnixDate(dateToFormat) {\n                        var dateObj = new Date(dateToFormat * 1000);\n\n                        var month = dateObj.getUTCMonth() + 1;\n                        var day = dateObj.getUTCDate();\n                        var year = dateObj.getUTCFullYear();\n\n                        return month + \"/\" + day + \"/\" + year;\n                    }\n\n                    if (Array.isArray(historyitems.responses)) {\n                        historyitems.responses.forEach(function(item){\n                            item.displaydateofentry = _formatUnixDate(item.dateofentry);\n                            item.displayfiletitle = item.filetitle.substring(0, STATE.filetitledisplaylength) + '...';\n                        });\n                        historyitems.responses.formatted = JSON.stringify(historyitems.responses);\n                    }\n\n                    var context = {data: historyitems.responses};\n\n                    templates.render('atto_cloudpoodll/historypanel', context)\n                        .then(function (html, js) {\n                            templates.replaceNodeContents('div[data-field=\"history\"]', html, js);\n                        }).fail(function (ex) {\n                        notification.exception(ex);\n                    });\n                }\n            }]);\n        });\n    }\n\n    /**\n     * Loads the history video preview tab html.\n     *\n     * @method loadHistoryPreview\n     * @param historyItem History item ID from list.\n     */\n    loadHistoryPreview(historyItem) {\n        require(['core/templates', 'core/ajax', 'core/notification'], function (templates, ajax, notification) {\n            ajax.call([{\n                methodname: 'atto_cloudpoodll_history_get_item',\n                args: {'id': historyItem.dataset.historyId},\n                done: function (historyItemData) {\n                    var context = {\n                        data: historyItemData.responses,\n                        isVideo: STATE.currentrecorder === RECORDERS.VIDEO || STATE.currentrecorder === RECORDERS.SCREEN\n                    };\n                    templates.render('atto_cloudpoodll/historypreview', context)\n                        .then(function (html, js) {\n                            templates.replaceNodeContents('div[data-field=\"history\"]', html, js);\n                        }).fail(function (ex) {\n                        notification.exception(ex);\n                    });\n                }\n            }]);\n        });\n    }\n\n    /**\n     * Loads or reloads the recorders\n     *\n     * @method _loadRecorders\n     * @private\n     */\n    loadRecorders() {\n        var that = this;\n\n        that.uploaded = false;\n        that.ap_count = 0;\n        require(['tiny_poodll/cloudpoodllloader'], function (loader) {\n            var recorder_callback = function (evt) {\n                switch (evt.type) {\n                    case 'recording':\n                        if (evt.action === 'started') {\n                            //if user toggled subtitle checkbox any time from now, the recording would be lost\n                            if (STATE.subtitlecheckbox != null) {\n                                STATE.subtitlecheckbox.set('disabled', true);\n                            }\n\n                        }\n                        break;\n                    case 'awaitingprocessing':\n                        //we delay  a second to allow the sourcefile to be copied to correct location\n                        //the source filename will sometimes be incorrect because we do not know it when creating the dynamo db entry\n                        // but an incorrect ext is just confusing. most players will ignore it and deal with contents\n                        if (!that.uploaded) {\n                            setTimeout(function () {\n                                var guessed_ext = loader.fetch_guessed_extension(STATE.currentrecorder );\n                                var sourcefilename = evt.sourcefilename.split('.').slice(0, -1).join('.') + '.' + guessed_ext;\n                                var sourceurl = evt.s3root + sourcefilename;\n                                that._doInsert(evt.mediaurl, evt.mediafilename, sourceurl, evt.sourcemimetype);\n                            }, 4000);\n                            that.uploaded = true;\n                        }\n                        break;\n                    case 'filesubmitted':\n                        //we will probably never get here because awaiting processing will fire first\n                        //we do not use this event, but it arrives when the final file is ready. (much earlier in case of non-transcode)\n\n                        break;\n                    case 'error':\n                        alert('PROBLEM:' + evt.message);\n                        break;\n                }\n            };\n            loader.init(CSS.CP_SWAP, recorder_callback);\n        });\n    }\n\n    /**\n     * Inserts the history item info the page.\n     *\n     * @method insertHistoryItem\n     * @param  historyItem object\n     * @private\n     */\n    insertHistoryItem(historyItem) {\n        poodllRecorder.getDialogue({\n            focusAfterHide: null\n        }).hide();\n\n        require(['core/ajax'], function (ajax) {\n            ajax.call([{\n                methodname: 'atto_cloudpoodll_history_get_item',\n                args: {'id': historyItem.dataset.historyId},\n                done: function (historyItemData) {\n                    //const [first] = historyItemData.responses;\n                    //var item = first;\n                    var item = historyItemData.responses[0];\n                    var mediaLink = poodllRecorder._createMediaLink(\n                        item.mediaurl,\n                        item.mediafilename,\n                        item.sourceurl,\n                        item.sourcemimetype\n                    );\n\n                    switch (STATE.insertmethod) {\n\n                        case INSERTMETHOD.TAGS:\n                            mediaLink.template = poodllRecorder._createMediaTemplate(mediaLink.context, item.sourcemimetype, mediaLink.template);\n                            break;\n\n                        case INSERTMETHOD.LINK:\n                        default:\n                        //do nothing we already made the template as a link\n                    }\n\n                    poodllRecorder._insertIntoEditor(mediaLink.template, mediaLink.context);\n                }\n            }]);\n        });\n    }\n\n    /**\n     * Creates the media link based on the recorder type.\n     *\n     * @method _createMediaLink\n     * @param  mediaurl media URL to the AWS object\n     * @param  mediafilename File name of the AWS object\n     * @param  sourceurl URL to the AWS object\n     * @param  sourcemimetype MimeType of the AWS object\n     * @private\n     */\n    createMediaLink(mediaurl, mediafilename, sourceurl, sourcemimetype) {\n        var context = {};\n        context.url = mediaurl;\n        context.name = mediafilename;\n        context.issubtitling = STATE.subtitling && STATE.subtitling !== '0';\n        context.includesourcetrack = STATE.transcoding && (mediaurl !== sourceurl) && (sourceurl.slice(-3) !== 'wav') && (sourceurl !== false);\n        context.CP = CLOUDPOODLL;\n        context.subtitleurl = mediaurl + '.vtt';\n        context.sourceurl = sourceurl;\n        context.sourcemimetype = sourcemimetype;\n\n        var template = TEMPLATES.HTML_MEDIA.LINK;\n\n        return {context: context, template: template};\n    }\n\n    /**\n     * Inserts the item into the editor.\n     *\n     * @method _createMediaLink\n     * @param  template HTML template to insert into the editor\n     * @param  context Context of the item being inserted\n     * @private\n     */\n    insertIntoEditor(template, context) {\n        var content =\n            Y.Handlebars.compile(template)(context);\n        this.editor.focus();\n        this.get('host').insertContentAtFocusPoint(content);\n        this.markUpdated();\n    }\n\n    /**\n     * Creates the media template for audio/video.\n     *\n     * @method _createMediaTemplate\n     * @param  context Context of the item being inserted\n     * @param  sourcemimetype MimeType of the AWS object\n     * @param  context Context of the item being inserted\n     * @private\n     */\n    createMediaTemplate(context, sourcemimetype, template) {\n        if (STATE.currentrecorder === RECORDERS.VIDEO || STATE.currentrecorder === RECORDERS.SCREEN) {\n            context.width = false;\n            context.height = false;\n            context.poster = false;\n            if (STATE.transcoding) {\n                context.urlmimetype = 'video/mp4';\n            } else {\n                context.urlmimetype = sourcemimetype;\n            }\n            template = TEMPLATES.HTML_MEDIA.VIDEO;\n        } else {\n            context.width = false;\n            context.height = false;\n            context.poster = false;\n            if (STATE.transcoding) {\n                context.urlmimetype = 'audio/mp3';\n            } else {\n                context.urlmimetype = sourcemimetype;\n            }\n            template = TEMPLATES.HTML_MEDIA.AUDIO;\n        }\n        return template;\n    }\n\n    /**\n     * Inserts the link or media element onto the page\n     * @method _doInsert\n     * @private\n     */\n    doInsert(mediaurl, mediafilename, sourceurl, sourcemimetype) {\n        this.getDialogue({\n            focusAfterHide: null\n        }).hide();\n\n        //default context values(link) for template\n        // var {context, template}\n        var medialink = this._createMediaLink(mediaurl, mediafilename, sourceurl, sourcemimetype);\n        var context = medialink.context;\n        var template = medialink.template;\n        function saveToHistory() {\n            require(['core/ajax'], function (ajax) {\n                ajax.call([{\n                    methodname: 'atto_cloudpoodll_history_create',\n                    args: {\n                        recordertype: STATE.currentrecorder,\n                        mediafilename: mediafilename,\n                        sourceurl: sourceurl,\n                        mediaurl: mediaurl,\n                        sourcemimetype: sourcemimetype,\n                        subtitling: STATE.subtitling ? 1 : 0,\n                        subtitleurl: STATE.subtitling ? mediaurl + '.vtt' : '',\n                    },\n                }]);\n            });\n        }\n\n        switch (STATE.insertmethod) {\n\n            case INSERTMETHOD.TAGS:\n                template = this._createMediaTemplate(context, sourcemimetype, template);\n                break;\n\n            case INSERTMETHOD.LINK:\n                break;\n            default:\n            //do nothing special actually.\n        }\n        saveToHistory();\n        this._insertIntoEditor(template, context);\n    } //end of doinsert\n\n    static fetchRecorderDimensions(config) {\n\n        // Get return object\n        var sizes = {};\n\n        //get video sizes]\n        switch (config.videoskin) {\n            case SKIN.ONETWOTHREE:\n            case SKIN.SCREEN:\n                sizes.videowidth = 441; //(because the @media CSS is for <=440)\n                sizes.videoheight = 540;\n                break;\n            case SKIN.BMR:\n                sizes.videowidth = 441; //(because the @media CSS is for <=440)\n                sizes.videoheight = 500;\n                break;\n            default:\n                sizes.videowidth = 441;\n                sizes.videoheight = 450;\n\n        }\n        switch (config.audioskin) {\n            default:\n                sizes.audiowidth = 450;\n                sizes.audioheight = 350;\n                break;\n        }\n        return sizes;\n    }\n\n    static getModalClass() {\n        const modalType = `${component}/rec_audio`;\n        const registration = ModalRegistry.get(modalType);\n        if (registration) {\n            return registration.module;\n        }\n\n        const AudioModal = class extends Modal {\n            static TYPE = modalType;\n            static TEMPLATE = `${component}/root`;\n        };\n\n        ModalRegistry.register(AudioModal.TYPE, AudioModal, AudioModal.TEMPLATE);\n        return AudioModal;\n    }\n\n    static getModalContext(editor) {\n\n        var context = {};\n        var config = getCloudpoodll(editor);\n        \n        //stuff declared in common\n        context.CSS = CSS;\n\n        //insert method\n        context.insertmethod = config.insertmethod;\n\n        //subtitle by default\n        context.subtitleaudiobydefault = config.subtitleaudiobydefault;\n        context.subtitlevideobydefault = config.subtitlevideobydefault;\n\n        //transcoding flag\n        context.transcoding = config.cp_transcode == '1';\n\n        //file title display length\n        context.filetitledisplaylength = config.filetitle_displaylength;\n\n        //show tabs\n        context.showhistory = config.showhistory== '1';\n        context.showupload = config.showupload== '1';\n        context.showoptions = config.showoptions== '1';\n        context.showexpiredays = config.showexpiredays== '1';\n\n        //set up the cloudpoodll div\n        context.CP={};\n        context.CP.parent = M.cfg.wwwroot;\n        context.CP.appid = 'tiny_poodll';\n        context.CP.token = config.cp_token;\n        context.CP.region = config.cp_region;\n        context.CP.owner = config.cp_owner;\n        context.CP.expiredays = config.cp_expiredays;\n        context.CP.cansubtitle = config.cp_cansubtitle;\n        context.CP.language = config.cp_language;\n        context.CP.transcode = config.cp_transcode;\n        context.CP.audioskin = config.cp_audioskin;\n        context.CP.videoskin = config.cp_videoskin;\n        context.CP.fallback = config.fallback;\n        context.CP.sizes = this.fetchRecorderDimensions(config);\n        return context;\n    }\n\n    static async display(editor) {\n        const ModalClass = this.getModalClass();\n        const templatecontext = this.getModalContext(editor);\n        templatecontext.isaudio=true;\n        const modal = await ModalFactory.create({\n            type: ModalClass.TYPE,\n            templateContext: templatecontext,\n            large: true,\n        });\n\n        // Set up the Recorder.\n        const recorder = new this(editor, modal, templatecontext);\n        recorder.loadRecorders();\n       // if (recorder.isReady()) {\n            modal.show();\n        //}\n        return modal;\n    }\n\n} //end of class\n"],"names":["constructor","editor","modal","config","ready","modalRoot","getRoot","registerEventListeners","close","hide","displayWidgetsDialogue","e","clickedicon","preventDefault","dialogue","this","getDialogue","headerContent","M","util","get_string","COMPONENTNAME","width","focusAfterHide","set","bodycontent","Y","Node","create","template","Handlebars","compile","BUTTONSHEADERTEMPLATE","content","headertext","append","buttons","_getButtonsForNames","Array","each","button","show","markUpdated","getButtonsForNames","allcontent","CLOUDPOODLL","names","thename","currentindex","BUTTONTEMPLATE","elementid","get","name","templateindex","_form","one","CSS","NAMEBUTTON","on","_showTemplateForm","push","getSubmitButtons","SUBMITTEMPLATE","inserttext","INPUTSUBMIT","_doWidgetsInsert","displayDialogue","recorder","_currentrecorder","RECORDERS","WIDGETS","STATE","currentrecorder","SCREEN","title","height","VIDEO","videoskin","SKIN","ONETWOTHREE","PLAIN","BMR","AUDIO","cansubtitle","subtitling","subtitlevideobydefault","subtitleaudiobydefault","d_conf","output","token","context","_getContext","that","require","templates","ajax","notification","render","then","html","js","subtitlecheckbox","SUBTITLE_CHECKBOX","mediainsertcheckbox","MEDIAINSERT_CHECKBOX","languageselect","LANG_SELECT","expiredays","EXPIREDAYS_SELECT","topnode","ATTO_CLOUDPOODLL_FORM","poodllRecorder","currentTarget","all","CP_SWAP","setAttribute","empty","_loadRecorders","_disableSubtitleCheckbox","insertmethod","INSERTMETHOD","TAGS","LINK","element","language","fail","ex","exception","_displayWidgetsDialogue","disableSubtitleCheckbox","loadHistory","call","methodname","args","done","historyitems","isArray","responses","forEach","item","dateToFormat","dateObj","displaydateofentry","dateofentry","Date","getUTCMonth","getUTCDate","getUTCFullYear","displayfiletitle","filetitle","substring","filetitledisplaylength","formatted","JSON","stringify","data","replaceNodeContents","loadHistoryPreview","historyItem","dataset","historyId","historyItemData","isVideo","loadRecorders","uploaded","ap_count","loader","init","evt","type","action","setTimeout","guessed_ext","fetch_guessed_extension","sourcefilename","split","slice","join","sourceurl","s3root","_doInsert","mediaurl","mediafilename","sourcemimetype","alert","message","insertHistoryItem","mediaLink","_createMediaLink","_createMediaTemplate","_insertIntoEditor","createMediaLink","url","issubtitling","includesourcetrack","transcoding","CP","subtitleurl","TEMPLATES","HTML_MEDIA","insertIntoEditor","focus","insertContentAtFocusPoint","createMediaTemplate","poster","urlmimetype","doInsert","medialink","recordertype","sizes","videowidth","videoheight","audioskin","audiowidth","audioheight","modalType","component","registration","ModalRegistry","module","AudioModal","Modal","register","TYPE","TEMPLATE","cp_transcode","filetitle_displaylength","showhistory","showupload","showoptions","showexpiredays","parent","cfg","wwwroot","appid","cp_token","region","cp_region","owner","cp_owner","cp_expiredays","cp_cansubtitle","cp_language","transcode","cp_audioskin","cp_videoskin","fallback","fetchRecorderDimensions","ModalClass","getModalClass","templatecontext","getModalContext","isaudio","ModalFactory","templateContext","large"],"mappings":"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"}