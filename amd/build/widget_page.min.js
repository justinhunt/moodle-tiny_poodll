define("tiny_poodll/widget_page",["exports","core/str","core/pending","core/log","./options","core/toast","core/modal_events","core/modal_factory","core/templates","core/notification","core/prefetch","./modal","core/modal_registry","./common"],(function(_exports,_str,_pending,_log,_options,_toast,ModalEvents,ModalFactory,Templates,Notification,_prefetch,_modal,_modal_registry,_common){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_pending=_interopRequireDefault(_pending),_log=_interopRequireDefault(_log),ModalEvents=_interopRequireWildcard(ModalEvents),ModalFactory=_interopRequireWildcard(ModalFactory),Templates=_interopRequireWildcard(Templates),Notification=_interopRequireWildcard(Notification),_modal=_interopRequireDefault(_modal),_modal_registry=_interopRequireDefault(_modal_registry);return _exports.default=class{constructor(editor,elementid,modal,config){this.ready=!1,this.editor=editor,this.elementid=elementid,this.config=config,this.modal=modal,this.modalRoot=modal.getRoot()[0],this.registerEvents(),this.ready=!0}close(){this.modal.hide()}getElement(component){return this.modalRoot.querySelector("#"+this.elementid+"_"+component)}registerEvents(){this.modal.getRoot()[0].querySelectorAll("."+_common.CSS.CP_SWAP)}displayWidgetsDialogue(e,clickedicon){e.preventDefault();var dialogue=this.getDialogue({headerContent:M.util.get_string("dialogtitle",COMPONENTNAME),width:"800px",focusAfterHide:clickedicon});"800px"!==dialogue.width&&dialogue.set("width","800px");var bodycontent=Y.Node.create("<div></div>"),template=Y.Handlebars.compile(BUTTONSHEADERTEMPLATE),content=Y.Node.create(template({headertext:M.util.get_string("chooseinsert",COMPONENTNAME)}));bodycontent.append(content);var buttons=this._getButtonsForNames(clickedicon);Y.Array.each(buttons,(function(button){bodycontent.append(button)}),bodycontent),dialogue.set("bodyContent",bodycontent),dialogue.show(),this.markUpdated()}doInsert(mediaurl,mediafilename,sourceurl,sourcemimetype){var that=this;switch(this.config.insertmethod){case INSERTMETHOD.TAGS:this.fetchMediaTags(mediaurl,mediafilename,sourceurl,sourcemimetype).then((function(insert){_log.default.debug("inserting into editor"),that.editor.insertContent(insert.html),that.close()}));break;case INSERTMETHOD.LINK:default:this.fetchMediaLink(mediaurl,mediafilename,sourceurl,sourcemimetype).then((function(insert){_log.default.debug("inserting into editor"),_log.default.debug(insert.html),that.editor.insertContent(insert.html),that.close()}))}}static generateRandomString(){for(var characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",result="",i=0;i<8;i++){var randomIndex=Math.floor(Math.random()*characters.length);result+=characters.charAt(randomIndex)}return result}static getModalClass(){var _class;const modalType="".concat(_common.component,"/widgetpage"),registration=_modal_registry.default.get(modalType);if(registration)return registration.module;const WidgetModal=(_defineProperty(_class=class extends _modal.default{},"TYPE",modalType),_defineProperty(_class,"TEMPLATE","".concat(_common.component,"/widgetpage")),_class);return _modal_registry.default.register(WidgetModal.TYPE,WidgetModal,WidgetModal.TEMPLATE),WidgetModal}static getModalContext(editor){var context={},config=(0,_options.getConfig)(editor);return _log.default.debug(config),context.CSS=_common.CSS,context}static async display(editor){const ModalClass=this.getModalClass(),templatecontext=this.getModalContext(editor),modal=(this.generateRandomString(),await ModalFactory.create({type:ModalClass.TYPE,templateContext:templatecontext,large:!0}));return modal.show(),modal}},_exports.default}));

//# sourceMappingURL=widget_page.min.js.map